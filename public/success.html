<!DOCTYPE html>
<html>
<head>
  <title>Gracias por su preferencia!</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div style="margin-top: 10%; font-family: Arial, sans-serif; color: #333; padding: 20px; background-color: #1F7832; border: 1px solid #195c28; border-radius: 5px; text-align: center; height: 300px; width: 90vw; display: flex; justify-content: center; align-items: center; margin-left: 2vw;">
    <div>
        <h1 style="font-weight: 100; color: #ffffff;">¡Transacción exitosa!</h1>
        <h3 style="color: #ffffff;">Redirigiendo...</h3>
    </div>
  </div>
  <script>
    function extraerUrl() {
    const urlCompleta = window.location.href;
    const parsedURL = new URL(urlCompleta);
    
    const {pathname} = parsedURL;
    return { origin: parsedURL.origin, pathname };
  }
    const urlParams = new URLSearchParams(window.location.search);
        const id_cliente = urlParams.get('id_cliente');
        const monto = urlParams.get('monto');
        const metodo_pago = urlParams.get('metodo_pago');
        const descripcion = urlParams.get('descripcion');
        // const dato_pago = urlParams.get('dato_pago');
        // console.log(dato_pago)
        // Aquí puedes hacer una llamada a tu API para registrar el pago
        
        const fecha = new Date()
        
        const mes = fecha.getMonth() + 1
        const anio = fecha.getFullYear()
        const newID = `${id_cliente}-${mes.toString().padStart(2, '0')}${anio}`
        

        const pagoData = {
          id: newID,
          id_cliente,
          monto,
          metodo_pago,
          descripcion,
          // Formato ISO para la fecha
        };
        const donde = 'http://localhost:4242';
        const {origin, pathname} = extraerUrl();
        const success = pathname.includes('success');
        const ruta_fetch = 
        origin === donde 
        ? 'http://localhost:3000' 
        : 'https://apispeed-i7gp.onrender.com';
            console.log({donde, ruta_fetch});
        fetch(`${ruta_fetch}/api/pagos/registro`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(pagoData)
        })
        .then(response => response.json())
        .then(data => {
            // console.log('Pago registrado:', data);
            setTimeout(function() {
            const donde = 'http://localhost:4242';
            const {origin, pathname} = extraerUrl();
            const success = pathname.includes('success');
            const ruta = origin === donde ? 'http://localhost:4200/planes' : 'https://speed-pro-desarrollo.web.app/planes';
            
            window.location.replace(ruta);
        }, 2000);
        })
        .catch(error => {
            console.error('Error al registrar el pago:', error);
        });
  </script>
</body>
</html>